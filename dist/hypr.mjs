import{parse as t,match as e,exec as o}from"matchit";import r from"react";import n from"picostate";import{connect as a,Provider as i}from"@picostate/react";import c from"nanoclass";import{hydrate as u}from"react-dom";import{parse as s}from"flatted/esm";var l=n({});function f(t,e){var o="function"==typeof t?t(l.state):t;o=o.replace(window.location.origin,""),l.hydrate({location:o})(function(){e(o)})}var p={get state(){return l.state},replaceState:function(t){f(t,function(t){window.history.replaceState({},"",t)})},pushState:function(t,e){f(t,function(t){!e&&window.history.pushState({},"",t)})}};function d(t){return function(e){return r.createElement(t,Object.assign({},{history:p},e))}}var h=createStore({});function m(t){return function(e){return a(t)(e)}}function v(t){var e=t.children,o=t.href,n=t.className,a=t.target,i=t.download,u=function(t,e){var o={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&-1===e.indexOf(r)&&(o[r]=t[r]);return o}(t,["children","href","className","target","download"]),s=c([n,p.location===o&&"active"]),l={};return a&&(l.target=a),i&&(l.download=i),r.createElement("a",Object.assign({},{href:o,className:s,onClick:function(t){t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.defaultPrevented||"_blank"===l.target||l.download||/mailto|tel/.test(o)||/^(https?:)?\/\//.test(o)||(t.preventDefault(),p.pushState(o))}},l,u),e)}var w=function(t){function e(e){var o=this;t.call(this,e),this.state={children:e.children.pop?e.children[0]:e.children},this.currentLocation=e.location,l.listen(function(t){var r=t.location,n=e.router(r),a=n[0],i=n[1];if(r!==o.currentLocation)return a.redirect?p.pushState(a.redirect.to):void e.resolve({location:r,params:i,route:a},function(t){o.currentLocation=r,o.setState({children:t})})})}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.componentDidMount=function(){window.addEventListener("popstate",function(t){t.target.window&&p.pushState(t.target.location.href,!0)})},e.prototype.render=function(){return this.state.children},e}(r.Component);function y(n,a,c){void 0===a&&(a={}),void 0===c&&(c={});var l=window.location.href.replace(window.location.origin,""),f=function(r,n){void 0===n&&(n=[]);var a=r.map(function(e){return t(e[0])}),i=r.reduce(function(t,e){return t[e[0]]=e[1],t},{});return function(t){var r=e(t,a);return r.length?[i[r[0].old],o(t,r)]:[]}}(n.map(function(t){return[t.pathname,function(t,e){var o={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&-1===e.indexOf(r)&&(o[r]=t[r]);return o}(t,["pathname"])]})),d=f(l),m=d[0],v=d[1],y=s(JSON.stringify(window.__hypr));return h.hydrate(Object.assign({},y,a,{router:{location:l,params:v}})),function(t){u(r.createElement(w,{router:f,location:l,resolve:function(t,e){var o=t.route;h.hydrate({router:{location:t.location,params:t.params}});var r=o.load;void 0===r&&(r=function(){});Promise.resolve(r(h.state)).then(function(t){var r=t.redirect,n=t.meta,a=t.props;if(r)return p.pushState(r.to);h.hydrate(a),Promise.resolve(c.resolve&&c.resolve(h.state)).then(function(){document.title=n.title||document.title,e(o.view(h.state))}).catch(function(t){console.log("options.resolve failed")})}).catch(function(t){console.log("route.load failed")})}},r.createElement(i,{store:h},m.view(h.state))),t)}}export{y as client,d as withHistory,p as history,m as withState,h as store,v as Link,w as Router};
//# sourceMappingURL=hypr.mjs.map
