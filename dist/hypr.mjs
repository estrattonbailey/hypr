import t from"react";import{parse as e,match as o,exec as r}from"matchit";import n from"picostate";import{hydrate as i}from"react-dom";import{Provider as a}from"@picostate/react";import{parse as c}from"flatted/esm";var u=n({}),s={get state(){return u.state},update:function(t,e){var o="function"==typeof t?t(this.state):t;o=o.replace(window.location.origin,""),u.hydrate({location:o})(function(){e(o)})},replaceState:function(t){this.update(t,function(t){window.history.replaceState({},"",t)})},pushState:function(t,e){this.update(t,function(t){!e&&window.history.pushState({},"",t)})}};var p=function(t){function e(e){var o=this;t.call(this,e),this.state={children:e.children.pop?e.children[0]:e.children},this.currentLocation=e.location,u.listen(function(t){var r=t.location,n=e.router(r),i=n[0],a=n[1];if(r!==o.currentLocation)return i.redirect?s.pushState(i.redirect.to):void e.resolve({location:r,params:a,route:i},function(t){o.setState({children:t})})})}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.componentDidMount=function(){window.addEventListener("popstate",function(t){t.target.window&&s.pushState(t.target.location.href,!0)})},e.prototype.render=function(){return this.state.children},e}(t.Component);var l=n({});function f(n,u,f){void 0===u&&(u={}),void 0===f&&(f={});var d=window.location.href.replace(window.location.origin,""),h=function(t,n){void 0===n&&(n=[]);var i=t.map(function(t){return e(t[0])}),a=t.reduce(function(t,e){return t[e[0]]=e[1],t},{});return function(t){var e=o(t,i);return e.length?[a[e[0].old],r(t,e)]:[]}}(n.map(function(t){return[t.pathname,function(t,e){var o={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&-1===e.indexOf(r)&&(o[r]=t[r]);return o}(t,["pathname"])]})),m=h(d),v=m[0],w=m[1],y=c(JSON.stringify(window.__hypr));return l.hydrate(Object.assign({},y,u,{router:{location:d,params:w}})),function(e){i(t.createElement(p,{router:h,location:d,resolve:function(t,e){var o=t.route;l.hydrate({router:{location:t.location,params:t.params}});var r=o.load;void 0===r&&(r=function(){});Promise.resolve(r(l.state)).then(function(t){var r=t.redirect,n=t.meta,i=t.props;if(r)return s.pushState(r.to);l.hydrate(i),Promise.resolve(f.resolve&&f.resolve(l.state)).then(function(){document.title=n.title||document.title,e(o.view(l.state))}).catch(function(t){console.log("options.resolve failed")})}).catch(function(t){console.log("route.load failed")})}},t.createElement(a,{store:l},v.view(l.state))),e)}}export{f as client};
//# sourceMappingURL=hypr.mjs.map
