import t from"picostate";import"html-meta-tags";import{renderToString as e}from"hyperapp-render";import{router as n,route as r}from"foil";import{h as o,patch as a}from"superfine";export{h}from"superfine";var i=t({}),s=t({});function l(t,e,n){return"\n    <!DOCTYPE html>\n    <html lang='en'>\n      <head>\n        <script>console.log('so nice')<\/script>\n        <meta charset='utf-8'>\n        <meta http-equiv='X-UA-Compatible' content='IE=edge'>\n        <meta name='viewport' content='width=device-width,initial-scale=1'>\n        <link rel=\"icon\" type=\"image/png\" sizes=\"32x32\" href=\"/static/favicon.png\">\n        <link rel='canonical' href='so-nice.site'>\n        <title>"+e.title+"</title>\n        "+require("html-meta-tags")(e)+"\n      </head>\n\n      <body>\n        <div id='root'>"+n+"</div>\n        <script>\n          window.__hypr = {\n            app: "+JSON.stringify(t)+"\n          }\n        <\/script>\n      </body>\n    </html>\n  "}process;function c(t,e,n){t.writeHead(n||302,{Location:e.to,Referer:e.from}),t.end()}function d(t,o){var a=n(t.map(function(t){return r({path:t.path,payload:{load:t.load,view:t.view}})}));return function(t,n){var r=a.resolve(t.url),o=r.payload,i=r.redirect,d=r.context;return o?i&&i.to?c(n,i):(s.hydrate({router:d}),n.setHeader("Content-Type","text/html"),Promise.resolve(o.load({req:t,state:s.state})||{}).then(function(t){var r=t.redirect,a=t.meta,i=t.state,d=t.server;if(void 0===d&&(d={}),r&&r.to)return c(n,r,h);s.hydrate(i);var p=d.cache,h=d.status;n.setHeader("Cache-Control",!1!==p?"public, max-age="+(p||86400):"no-cache, no-store, must-revalidate"),n.statusCode=h||200;var u=e(o.view(s.state));console.log(u),n.end(l(s.state,a,u))}).catch(function(t){var r={title:"500 - Server Error"};s.hydrate({meta:r}),n.statusCode=500,n.end(l(s.state,r,e(o.view(s.state)))),function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];console.log.apply(console,t)}(t)})):(n.statusCode=404,void n.end())}}function p(t,e,o){var l=n(t.map(function(t){return r({path:t.path,payload:{load:t.load,view:t.view}})})).resolve(req.url),c=l.context;function d(t,e){e=a(e,i.state.payload.view(t),o)}i.hydrate({payload:l.payload,context:c}),s.hydrate({router:c}),s.hydrate(window.__hypr.app),s.listen(d),i.listen(function(t){d(s.state)}),d(s.state)}export{d as server,p as client};
//# sourceMappingURL=hypr.es.js.map
