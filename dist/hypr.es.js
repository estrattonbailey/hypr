import e from"picostate";import"html-meta-tags";import t from"react";import{renderToString as r}from"react-dom/server";import{router as o,route as n}from"foil";import{Router as a}from"@foil/react";import{Provider as i}from"@picostate/react";import{hydrate as c}from"react-dom";var l=e({}),d=e({});function s(e,t,r){return"\n    <!DOCTYPE html>\n    <html lang='en'>\n      <head>\n        <meta charset='utf-8'>\n        <meta http-equiv='X-UA-Compatible' content='IE=edge'>\n        <meta name='viewport' content='width=device-width,initial-scale=1'>\n        <link rel=\"icon\" type=\"image/png\" sizes=\"32x32\" href=\"/static/favicon.png\">\n        <link rel='canonical' href='so-nice.site'>\n        <title>"+t.title+"</title>\n        "+require("html-meta-tags")(t)+"\n      </head>\n\n      <body>\n        <div id='root'>"+r+"</div>\n        <script>\n          window.__hypr = {\n            app: "+JSON.stringify(e)+"\n          }\n        <\/script>\n        <script src='/index.js'><\/script>\n      </body>\n    </html>\n  "}process;function m(e,t,r){e.writeHead(r||302,{Location:t.to,Referer:t.from}),e.end()}function p(e,c){var l=o(e.map(function(e){return n({path:e.path,payload:{load:e.load,view:e.view}})}));return function(e,o){var n=l.resolve(e.url),c=n.payload,p=n.redirect,u=n.context;return c?p&&p.to?m(o,p):(d.hydrate({router:u}),o.setHeader("Content-Type","text/html"),Promise.resolve(c.load({req:e,state:d.state})||{}).then(function(e){var n=e.redirect,p=e.meta,v=e.state,h=e.server;if(void 0===h&&(h={}),n&&n.to)return m(o,n,y);d.hydrate(v);var f=h.cache,y=h.status;o.setHeader("Cache-Control",!1!==f?"public, max-age="+(f||86400):"no-cache, no-store, must-revalidate"),o.statusCode=y||200;var w=r(t.createElement(a,{router:l,context:u,resolve:function(e,t){t(e.payload.view)}},t.createElement(i,{store:d},t.createElement(c.view,d.state))));o.end(s(d.state,p,w))}).catch(function(e){var t={title:"500 - Server Error"};d.hydrate({meta:t}),o.statusCode=500,o.end(s(d.state,t,"404")),function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];console.log.apply(console,e)}(e)})):(o.statusCode=404,void o.end())}}function u(e,r){return function(s){var m=o(e.map(function(e){return n({path:e.path,payload:{load:e.load,view:e.view}})})),p=m.resolve(window.location.pathname),u=p.payload,v=p.context;l.hydrate({payload:u,context:v}),d.hydrate({router:v}),d.hydrate(window.__hypr.app),c(t.createElement(a,{router:m,context:v,resolve:function(e,t){t(e.payload.view)}},t.createElement(i,{store:d},t.createElement(u.view,r))),s)}}export{p as server,u as client};
//# sourceMappingURL=hypr.es.js.map
